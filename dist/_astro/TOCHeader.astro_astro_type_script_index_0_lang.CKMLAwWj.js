const p="Overview";const g=2*Math.PI*10;class v{progressCircle=null;currentSectionText=null;detailsElement=null;listElement=null;scrollArea=null;headings=[];regions=[];activeIds=[];reset(){this.progressCircle=document.getElementById("mobile-toc-progress-circle"),this.currentSectionText=document.getElementById("mobile-toc-current-section"),this.detailsElement=document.querySelector("#mobile-toc-container details"),this.listElement=document.getElementById("mobile-table-of-contents");const t=document.getElementById("mobile-toc-container");this.scrollArea=t?.querySelector("[data-radix-scroll-area-viewport]")||null,this.headings=[],this.regions=[],this.activeIds=[],this.progressCircle&&(this.progressCircle.style.strokeDasharray=g.toString(),this.progressCircle.style.strokeDashoffset=g.toString())}}const e=new v;class a{static build(){if(e.headings=Array.from(document.querySelectorAll(".prose h2, .prose h3, .prose h4, .prose h5, .prose h6")),e.headings.length===0){e.regions=[];return}e.regions=e.headings.map((t,i)=>{const s=e.headings[i+1];return{id:t.id,start:t.offsetTop,end:s?s.offsetTop:document.body.scrollHeight}})}static getVisibleIds(){if(e.headings.length===0)return[];const t=window.scrollY+138,i=window.scrollY+window.innerHeight,s=new Set,o=(n,r)=>n>=t&&n<=i||r>=t&&r<=i||n<=t&&r>=i;return e.headings.forEach(n=>{const r=n.offsetTop+n.offsetHeight;o(n.offsetTop,r)&&s.add(n.id)}),e.regions.forEach(n=>{if(n.start<=i&&n.end>=t){const r=document.getElementById(n.id);if(r){const d=r.offsetTop+r.offsetHeight;n.end>d&&(d<i||t<n.end)&&s.add(n.id)}}}),Array.from(s)}}class f{static update(){if(!e.scrollArea)return;const{scrollTop:t,scrollHeight:i,clientHeight:s}=e.scrollArea,o=5,n=t<=o,r=t>=i-s-o;e.scrollArea.classList.toggle("mask-t-from-80%",!n),e.scrollArea.classList.toggle("mask-b-from-80%",!r)}}class u{static update(t){!e.listElement||!e.currentSectionText||(e.listElement.querySelectorAll(".mobile-toc-item").forEach(i=>{const s=i,o=s.dataset.headingId;o&&t.includes(o)?s.classList.add("text-foreground"):s.classList.remove("text-foreground")}),t.length>0&&this.scrollToActive(t[0]),this.updateCurrentSectionText(t))}static updateCurrentSectionText(t){if(!e.currentSectionText)return;let i=p;if(t.length>0){const s=e.headings.filter(o=>t.includes(o.id)&&o.textContent).map(o=>o.textContent.trim());s.length>0&&(i=s.join(", "))}e.currentSectionText.textContent=i}static scrollToActive(t){if(!e.listElement)return;const i=e.listElement.querySelector(`[data-heading-id="${t}"]`);if(!i)return;const s=e.scrollArea;if(!s)return;const{top:o,height:n}=s.getBoundingClientRect(),{top:r,height:d}=i.getBoundingClientRect(),E=r-o+s.scrollTop,m=Math.max(0,Math.min(E-(n-d)/2,s.scrollHeight-s.clientHeight));Math.abs(m-s.scrollTop)>5&&(s.scrollTop=m)}static setupInteraction(){e.listElement&&(e.listElement.querySelectorAll(".mobile-toc-item").forEach(t=>{t.addEventListener("click",()=>{e.detailsElement&&(e.detailsElement.open=!1)})}),e.scrollArea&&e.scrollArea.addEventListener("scroll",()=>f.update(),{passive:!0}),e.detailsElement&&e.detailsElement.addEventListener("toggle",()=>{e.detailsElement?.open&&setTimeout(f.update,100)}))}}class l{static update(){if(!e.progressCircle)return;const t=document.documentElement.scrollHeight-window.innerHeight,i=t>0?Math.min(Math.max(window.scrollY/t,0),1):0;e.progressCircle.style.strokeDashoffset=(g*(1-i)).toString()}}class h{static handleScroll(){const t=a.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,u.update(e.activeIds)),l.update()}static handleResize(){a.build();const t=a.getVisibleIds();JSON.stringify(t)!==JSON.stringify(e.activeIds)&&(e.activeIds=t,u.update(e.activeIds)),l.update()}static init(){if(e.reset(),a.build(),!!e.currentSectionText){if(e.headings.length===0){e.currentSectionText.textContent=p,window.addEventListener("scroll",l.update,{passive:!0}),l.update();return}e.activeIds=a.getVisibleIds(),u.update(e.activeIds),l.update(),u.setupInteraction(),window.addEventListener("scroll",this.handleScroll,{passive:!0}),window.addEventListener("resize",this.handleResize,{passive:!0})}}static cleanup(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("scroll",l.update),window.removeEventListener("resize",this.handleResize),e.activeIds=[],e.headings=[],e.regions=[]}}document.addEventListener("astro:page-load",()=>h.init());document.addEventListener("astro:after-swap",()=>{h.cleanup(),h.init()});document.addEventListener("astro:before-swap",()=>h.cleanup());
